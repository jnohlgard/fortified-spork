[Output]
Format=cpio
Output=initrd_%v
CompressOutput=yes

[Content]
MakeInitrd=yes
SourceDateEpoch=0
Bootable=no
BuildPackages=
ExtraTrees=../secure-boot/public:/etc/secure-boot/

Packages=

# System base
Packages=
         audit-libs
         bash
         coreutils
         dbus
         kbd
         qrencode
         sudo
         systemd
         udev
         util-linux
         zram-generator

# Measured boot
Packages=
         efibootmgr
         efitools
         efivar
         ima-evm-utils
         keyutils
         sbsigntools
         tpm2-tools
         tpm2-tss

# Disks
Packages=
         device-mapper
         lvm2
         mdadm
         nvme-cli

# File systems
Packages=
         btrfs-progs
         composefs
         dosfstools
         e2fsprogs
         erofs-utils
         fuse
         f2fs-tools
         gdisk
         squashfs-tools
         xfsprogs

# Encryption/authentication
Packages=
         #clevis-luks
         #clevis-pin-tpm2
         #clevis-systemd
         cryptsetup
         fido2-tools
         gnupg2
         google-authenticator
         integritysetup
         libfido2
         oathtool
         #tpm2-pkcs11
         #tpm2-pkcs11-tools
         tpm2-tss
         veritysetup

# Network setup
Packages=
         ca-certificates
         iproute
         iputils

# Compression/archives
Packages=
         cpio
         tar
         gzip
         bzip2
         xz
         zip
         zstd

# Useful tools
Packages=
         acl
         attr
         busybox
         curl
         diffutils
         findutils
         gawk
         jq
         less
         lsof
         nano
         openssh-clients
         openssl
         passwd
         procps-ng
         rsync
         sed
         shadow-utils
         vim-minimal
         wget
         xxd

CleanPackageMetadata=yes
RemoveFiles=
            # we don't need this after the binary catalogs have been built
            /usr/lib/systemd/catalog
            /etc/udev/hwdb.d
            /usr/lib/udev/hwdb.d

            # this is not needed by anything updated in the last 20 years
            /etc/services

            # Including kernel images in the initrd is generally not useful.
            # This also stops mkosi from extracting the kernel image out of the image as a separate output.
            /usr/lib/modules/*/vmlinuz*
            /usr/lib/modules/*/System.map

            /etc/pki/ca-trust/extracted/java
            /boot/efi/*
            /efi/EFI
            /var/log
            /var/cache
            /usr/lib/sysimage/libdnf5/transaction_history.sqlite*
            /var/cache/ldconfig/aux-cache
            /usr/share/gcc*
            /usr/share/gdb*
            /usr/share/gnupg/help.*.txt
            /usr/share/doc/*
            /usr/share/info/*
            /usr/share/man/*

# Not needed inside the initrd
RemovePackages=
               dracut
               systemd-boot

# Configure locale explicitly so that all other locale data is stripped on distros whose package manager supports it.
@Locale=C.UTF-8
WithDocs=no
